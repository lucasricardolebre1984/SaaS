<!doctype html>
<html lang="pt-BR" data-layout="fabio2" data-palette="ocean">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM Console | Fabio SaaS</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="shell-bg"></div>

    <div class="app-shell">
      <aside class="sidebar" id="sidebar">
        <div class="brand">
          <h1>FC Solucoes</h1>
          <p>CRM WhatsApp</p>
        </div>

        <nav class="module-nav">
          <button class="module-nav__item" type="button">01 Chat IA</button>
          <button class="module-nav__item is-active" type="button">02 CRM WhatsApp</button>
          <button class="module-nav__item" type="button">03 Clientes</button>
          <button class="module-nav__item" type="button">04 Agenda</button>
          <button class="module-nav__item" type="button">05 Cobranca</button>
        </nav>

        <p class="sidebar-note">
          Operacao de funil, follow-up e handoff para WhatsApp concierge.
        </p>
      </aside>

      <div class="content">
        <header class="topbar">
          <div class="topbar__left">
            <button id="mobileMenuBtn" class="menu-btn" type="button" aria-label="Abrir menu">Menu</button>
            <div>
              <p class="brand-caption">Modulo 02</p>
              <h2>CRM WhatsApp</h2>
            </div>
          </div>

          <div class="topbar__right">
            <label>API<input id="apiBase" value="" placeholder="auto (/api ou 4300)" /></label>
            <label>Tenant<input id="tenantId" value="tenant_automania" /></label>
            <label>
              Layout
              <select id="layoutSelect">
                <option value="fabio2">Fabio2</option>
                <option value="studio">Studio</option>
              </select>
            </label>
            <label>
              Paleta
              <select id="paletteSelect">
                <option value="ocean">Ocean</option>
                <option value="forest">Forest</option>
                <option value="sunset">Sunset</option>
              </select>
            </label>
            <button id="applyTenantThemeBtn" class="btn btn--ghost" type="button">Tema Tenant</button>
            <button id="reloadBtn" class="btn" type="button">Atualizar</button>
          </div>
        </header>

        <main class="workspace">
          <section class="main-grid">
            <section class="kpis">
              <article class="kpi card"><h3>New</h3><strong id="kpi-new">0</strong></article>
              <article class="kpi card"><h3>Qualified</h3><strong id="kpi-qualified">0</strong></article>
              <article class="kpi card"><h3>Proposal</h3><strong id="kpi-proposal">0</strong></article>
              <article class="kpi card"><h3>Won</h3><strong id="kpi-won">0</strong></article>
              <article class="kpi card"><h3>Lost</h3><strong id="kpi-lost">0</strong></article>
            </section>

            <section class="card leads-card">
              <header class="card__header">
                <h3>Leads</h3>
                <span id="leadCount" class="status-pill">0 items</span>
              </header>

              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Telefone</th>
                      <th>Canal</th>
                      <th>Stage</th>
                      <th>Acoes</th>
                    </tr>
                  </thead>
                  <tbody id="leadRows">
                    <tr><td colspan="5" class="empty">Sem dados carregados.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>

            <section class="card inbox-card">
              <header class="card__header">
                <h3>Inbox WhatsApp</h3>
                <span id="conversationCount" class="status-pill">0 conversas</span>
              </header>
              <div class="inbox-layout">
                <aside id="conversationList" class="conversation-list">
                  <p class="empty">Sem conversas para este tenant.</p>
                </aside>
                <section class="thread-panel">
                  <header class="thread-header">
                    <div>
                      <strong id="threadContact">Selecione uma conversa</strong>
                      <p id="threadMeta" class="thread-meta">Abra uma conversa para ler e responder mensagens.</p>
                    </div>
                    <div class="thread-actions">
                      <select id="threadStageSelect">
                        <option value="contacted">contacted</option>
                        <option value="qualified">qualified</option>
                        <option value="proposal">proposal</option>
                        <option value="negotiation">negotiation</option>
                        <option value="won">won</option>
                        <option value="lost">lost</option>
                        <option value="nurturing">nurturing</option>
                      </select>
                      <button id="threadAiSuggestBtn" class="btn btn--ghost" type="button">Sugerir Resposta IA</button>
                      <button id="threadQualifyBtn" class="btn btn--ghost" type="button">Qualificar por IA</button>
                      <button id="threadAiExecuteBtn" class="btn btn--ghost" type="button">Executar IA</button>
                      <button id="threadUpdateStageBtn" class="btn btn--ghost" type="button">Atualizar Stage</button>
                    </div>
                  </header>
                  <div id="threadMessages" class="thread-messages">
                    <p class="empty">Sem conversa selecionada.</p>
                  </div>
                  <form id="threadSendForm" class="thread-send-form">
                    <input id="threadMessageInput" placeholder="Digite a mensagem para WhatsApp..." />
                    <button class="btn" type="submit">Enviar</button>
                  </form>
                </section>
              </div>
            </section>
          </section>

          <aside class="side-stack">
            <section class="card">
              <header class="card__header">
                <h3>Novo Lead</h3>
              </header>

              <form id="leadForm" class="form">
                <label>Nome<input id="displayName" required placeholder="Lead Exemplo" /></label>
                <label>Telefone E.164<input id="phone" required value="+5511999999999" /></label>
                <label>Canal
                  <select id="sourceChannel">
                    <option value="whatsapp">whatsapp</option>
                    <option value="web">web</option>
                    <option value="manual">manual</option>
                  </select>
                </label>
                <label>Stage
                  <select id="stage">
                    <option value="new">new</option>
                    <option value="qualified">qualified</option>
                    <option value="proposal">proposal</option>
                    <option value="won">won</option>
                    <option value="lost">lost</option>
                  </select>
                </label>
                <button class="btn" type="submit">Criar Lead</button>
                <p id="formStatus" class="status">Aguardando acao.</p>
              </form>
            </section>

            <section class="card whatsapp-qr-card">
              <header class="card__header">
                <h3>Conectar WhatsApp</h3>
              </header>
              <p class="whatsapp-qr-desc">Use a mesma Evolution API do Docker (instancia diferente do fabio2 para nao conflitar).</p>
              <p class="whatsapp-qr-desc whatsapp-qr-note">Ao conectar, o dispositivo no celular deve aparecer como <strong>Evolution API</strong> (ou o nome configurado no servidor). Se aparecer &quot;Chrome&quot;, configure no servidor da Evolution: <code>CONFIG_SESSION_PHONE_CLIENT=Evolution API</code> e <code>CONFIG_SESSION_PHONE_NAME=Evolution API</code>.</p>
              <button id="whatsappQrBtn" class="btn" type="button">Gerar QR Code</button>
              <div id="whatsappQrResult" class="whatsapp-qr-result" hidden>
                <p class="whatsapp-qr-status" id="whatsappQrStatus"></p>
                <div id="whatsappQrImageWrap" class="whatsapp-qr-image-wrap"></div>
                <p id="whatsappPairingCode" class="whatsapp-pairing-code"></p>
              </div>
            </section>

            <section class="card insights-card">
              <header class="card__header">
                <h3>Orquestracao IA</h3>
              </header>
              <div class="insights">
                <p><strong>Handoff:</strong> Owner concierge despacha follow-up para persona WhatsApp.</p>
                <p><strong>Automacao:</strong> Cobranca e lembrete por etapa do funil.</p>
                <p><strong>Saida:</strong> Eventos auditaveis em contratos padrao do modulo.</p>
              </div>
            </section>
          </aside>
        </main>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
