<!doctype html>
<html lang="pt-BR" data-layout="studio" data-palette="darkgreen">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM Console | SaaS</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="shell-bg"></div>

    <div class="app-shell">
      <aside class="sidebar" id="sidebar">
        <div class="brand">
          <h1>SaaS</h1>
          <p>CRM WhatsApp</p>
        </div>

        <nav class="module-nav">
          <button class="module-nav__item" type="button">01 Chat IA</button>
          <button class="module-nav__item is-active" type="button">02 CRM WhatsApp</button>
          <button class="module-nav__item" type="button">03 Clientes</button>
          <button class="module-nav__item" type="button">04 Agenda</button>
          <button class="module-nav__item" type="button">05 Cobranca</button>
        </nav>

        <p class="sidebar-note">
          Operacao de funil, follow-up e handoff para WhatsApp concierge.
        </p>
      </aside>

      <div class="content">
        <header class="topbar">
          <div class="topbar__left">
            <button id="mobileMenuBtn" class="menu-btn" type="button" aria-label="Abrir menu">Menu</button>
            <div>
              <p class="brand-caption">Modulo 02</p>
              <h2>CRM WhatsApp</h2>
            </div>
          </div>

          <div class="topbar__right">
            <label>API<input id="apiBase" value="" placeholder="auto (/api ou 4300)" /></label>
            <label>Tenant<input id="tenantId" value="tenant_automania" /></label>
            <label>
              Layout
              <select id="layoutSelect">
                <option value="fabio2">Fabio2</option>
                <option value="studio">Studio</option>
              </select>
            </label>
            <label>
              Paleta
              <select id="paletteSelect">
                <option value="darkgreen">Dark Green</option>
                <option value="ocean">Ocean</option>
                <option value="forest">Forest</option>
                <option value="sunset">Sunset</option>
              </select>
            </label>
            <button id="applyTenantThemeBtn" class="btn btn--ghost" type="button">Tema Tenant</button>
            <button id="reloadBtn" class="btn" type="button">Atualizar</button>
          </div>
        </header>

        <main class="workspace">
          <section class="main-grid">
            <section class="card crm-commandbar">
              <div class="crm-commandbar__left">
                <button class="btn" type="button">Criar contato</button>
                <button class="btn btn--ghost" type="button">Importar</button>
                <button class="btn btn--ghost" type="button">Integrar</button>
              </div>
              <div class="crm-commandbar__right">
                <button class="btn btn--ghost" type="button">Automatizar</button>
                <button class="btn btn--ghost" type="button">Agrupar</button>
                <button class="btn btn--ghost" type="button">Filtrar</button>
              </div>
            </section>

            <section class="card crm-board-tabs">
              <button class="board-tab is-active" type="button">Quadro principal</button>
              <button class="board-tab" type="button">Cards</button>
              <button class="board-tab" type="button">Pipeline</button>
            </section>

            <section class="kpis">
              <article class="kpi card"><h3>New</h3><strong id="kpi-new">0</strong></article>
              <article class="kpi card"><h3>Qualified</h3><strong id="kpi-qualified">0</strong></article>
              <article class="kpi card"><h3>Proposal</h3><strong id="kpi-proposal">0</strong></article>
              <article class="kpi card"><h3>Won</h3><strong id="kpi-won">0</strong></article>
              <article class="kpi card"><h3>Lost</h3><strong id="kpi-lost">0</strong></article>
            </section>

            <section class="card crm-view-tabs">
              <button id="viewInboxBtn" class="view-tab is-active" type="button" data-view="inbox">Inbox</button>
              <button id="viewPipelineBtn" class="view-tab" type="button" data-view="pipeline">Pipeline</button>
              <button id="viewLeadsBtn" class="view-tab" type="button" data-view="leads">Leads</button>
            </section>

            <section class="card crm-toolbar">
              <label>Buscar
                <input id="leadSearchInput" type="search" placeholder="Nome, telefone ou ID..." />
              </label>
              <label>Stage
                <select id="leadStageFilter">
                  <option value="all">Todos</option>
                  <option value="new">new</option>
                  <option value="contacted">contacted</option>
                  <option value="qualified">qualified</option>
                  <option value="proposal">proposal</option>
                  <option value="negotiation">negotiation</option>
                  <option value="won">won</option>
                  <option value="lost">lost</option>
                  <option value="nurturing">nurturing</option>
                </select>
              </label>
              <label>Canal
                <select id="leadChannelFilter">
                  <option value="all">Todos</option>
                </select>
              </label>
              <label>Agrupar Pipeline
                <select id="leadGroupBy">
                  <option value="stage">Por stage</option>
                  <option value="channel">Por canal</option>
                </select>
              </label>
              <button id="leadClearFiltersBtn" class="btn btn--ghost" type="button">Limpar filtros</button>
            </section>

            <section id="pipelineViewCard" class="card pipeline-card hidden">
              <header class="card__header">
                <h3>Pipeline Kanban</h3>
                <span class="status-pill">Krayin-like</span>
              </header>
              <div id="pipelineBoard" class="pipeline-board">
                <p class="empty">Sem leads para renderizar pipeline.</p>
              </div>
            </section>

            <section id="leadsViewCard" class="card leads-card hidden">
              <header class="card__header">
                <h3>Leads</h3>
                <span id="leadCount" class="status-pill">0 items</span>
              </header>

              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Telefone</th>
                      <th>Canal</th>
                      <th>Stage</th>
                      <th>Acoes</th>
                    </tr>
                  </thead>
                  <tbody id="leadRows">
                    <tr><td colspan="5" class="empty">Sem dados carregados.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>

            <section id="inboxViewCard" class="card inbox-card">
              <header class="card__header">
                <h3>Inbox WhatsApp</h3>
                <span id="conversationCount" class="status-pill">0 conversas</span>
              </header>
              <div class="inbox-layout">
                <aside id="conversationList" class="conversation-list">
                  <p class="empty">Sem conversas para este tenant.</p>
                </aside>
                <section class="thread-panel">
                  <header class="thread-header">
                    <div>
                      <strong id="threadContact">Selecione uma conversa</strong>
                      <p id="threadMeta" class="thread-meta">Abra uma conversa para ler e responder mensagens.</p>
                    </div>
                    <div class="thread-actions">
                      <select id="threadStageSelect">
                        <option value="contacted">contacted</option>
                        <option value="qualified">qualified</option>
                        <option value="proposal">proposal</option>
                        <option value="negotiation">negotiation</option>
                        <option value="won">won</option>
                        <option value="lost">lost</option>
                        <option value="nurturing">nurturing</option>
                      </select>
                      <button id="threadAiSuggestBtn" class="btn btn--ghost" type="button">Sugerir Resposta IA</button>
                      <button id="threadQualifyBtn" class="btn btn--ghost" type="button">Qualificar por IA</button>
                      <button id="threadAiExecuteBtn" class="btn btn--ghost" type="button">Executar IA</button>
                      <button id="threadUpdateStageBtn" class="btn btn--ghost" type="button">Atualizar Stage</button>
                    </div>
                  </header>
                  <div id="threadMessages" class="thread-messages">
                    <p class="empty">Sem conversa selecionada.</p>
                  </div>
                  <form id="threadSendForm" class="thread-send-form">
                    <input id="threadMessageInput" placeholder="Digite a mensagem para WhatsApp..." />
                    <button class="btn" type="submit">Enviar</button>
                  </form>
                </section>
                <aside class="detail-panel">
                  <header class="detail-panel__header">
                    <h4>Detalhe do Lead</h4>
                  </header>
                  <dl class="detail-grid">
                    <dt>Nome</dt>
                    <dd id="detailLeadName">--</dd>
                    <dt>Stage</dt>
                    <dd id="detailLeadStage">--</dd>
                    <dt>Telefone</dt>
                    <dd id="detailLeadPhone">--</dd>
                    <dt>Canal</dt>
                    <dd id="detailLeadChannel">--</dd>
                    <dt>ID</dt>
                    <dd id="detailLeadId">--</dd>
                  </dl>
                  <section class="detail-activities">
                    <h5>Atividades</h5>
                    <ul id="detailActivityList">
                      <li class="empty">Sem atividades.</li>
                    </ul>
                  </section>
                </aside>
              </div>
            </section>
          </section>

          <aside class="side-stack">
            <section class="card analytics-card">
              <header class="card__header">
                <h3>Barras Graficas</h3>
              </header>
              <div class="analytics-wrap">
                <section>
                  <h4>Distribuicao por Stage</h4>
                  <div id="stageBars" class="metric-bars">
                    <p class="empty">Sem dados.</p>
                  </div>
                </section>
                <section>
                  <h4>Distribuicao por Canal</h4>
                  <div id="channelBars" class="metric-bars">
                    <p class="empty">Sem dados.</p>
                  </div>
                </section>
              </div>
            </section>

            <section class="card">
              <header class="card__header">
                <h3>Novo Lead</h3>
              </header>

              <form id="leadForm" class="form">
                <label>Nome<input id="displayName" required placeholder="Lead Exemplo" /></label>
                <label>Telefone E.164<input id="phone" required value="+5511999999999" /></label>
                <label>Canal
                  <select id="sourceChannel">
                    <option value="whatsapp">whatsapp</option>
                    <option value="web">web</option>
                    <option value="manual">manual</option>
                  </select>
                </label>
                <label>Stage
                  <select id="stage">
                    <option value="new">new</option>
                    <option value="qualified">qualified</option>
                    <option value="proposal">proposal</option>
                    <option value="won">won</option>
                    <option value="lost">lost</option>
                  </select>
                </label>
                <button class="btn" type="submit">Criar Lead</button>
                <p id="formStatus" class="status">Aguardando acao.</p>
              </form>
            </section>

            <section class="card whatsapp-qr-card">
              <header class="card__header">
                <h3>Conectar WhatsApp</h3>
              </header>
              <p class="whatsapp-qr-desc">Use a mesma Evolution API do Docker (instancia diferente do fabio2 para nao conflitar).</p>
              <p class="whatsapp-qr-desc whatsapp-qr-note">Ao conectar, o dispositivo no celular deve aparecer como <strong>Evolution API</strong> (ou o nome configurado no servidor). Se aparecer &quot;Chrome&quot;, configure no servidor da Evolution: <code>CONFIG_SESSION_PHONE_CLIENT=Evolution API</code> e <code>CONFIG_SESSION_PHONE_NAME=Evolution API</code>.</p>
              <button id="whatsappQrBtn" class="btn" type="button">Gerar QR Code</button>
              <div id="whatsappQrResult" class="whatsapp-qr-result" hidden>
                <p class="whatsapp-qr-status" id="whatsappQrStatus"></p>
                <div id="whatsappQrImageWrap" class="whatsapp-qr-image-wrap"></div>
                <p id="whatsappPairingCode" class="whatsapp-pairing-code"></p>
              </div>
            </section>

            <section class="card insights-card">
              <header class="card__header">
                <h3>Orquestracao IA</h3>
              </header>
              <div class="insights">
                <p><strong>Handoff:</strong> Owner concierge despacha follow-up para persona WhatsApp.</p>
                <p><strong>Automacao:</strong> Cobranca e lembrete por etapa do funil.</p>
                <p><strong>Saida:</strong> Eventos auditaveis em contratos padrao do modulo.</p>
              </div>
            </section>
          </aside>
        </main>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
